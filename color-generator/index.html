<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Геренрация цветов и градиентов!</title>
</head>
<body>
    <style>

        *{font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif; box-sizing: border-box;}
        *::selection{color: #ffffff; background-color: #b96271;}
        body{height: 100vh; padding: 0; margin: 0; transition: 200ms;}
        main{height: 100%;}
        body, html{-webkit-tap-highlight-color: #ffffff00; -webkit-tap-highlight-color: transparent;}
        
        .container{display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; transform: translateY(-20%);}
        .container .color.block{width: 250px; height: 250px; margin: 15px; border-radius: 7px; transition: 200ms;}
        .container .color.hex{margin: 0;}
        .container .color.generate{border: none; padding: 8px 15px; border-radius: 5px; outline: none; cursor: pointer; transition: 200ms; user-select: none; background: none;}
        .container .color.historybtn{width: 30px; height: 30px; background-color: #fff; position: absolute; z-index: 3; border-radius: 50%; outline-offset: 2px; cursor: pointer; top: calc(20% + 20px); right: 20px;}
        
        .history{position: absolute;top: 15px;right: 60px;background-color: #fff;padding: 10px;border-radius: 8px;display: flex;flex-direction: column; grid-gap: 10px;max-height: 300px;overflow-y: scroll;overflow-x: hidden;cursor: pointer;}
        .history::-webkit-scrollbar {width: 0;}
        .history .color.item{display: flex; grid-gap: 10px;}
        .history .color.demo{width: 20px; height: 20px; border-radius: 4px;}

    </style>
    <main>
        <div class="color container">
            <p class="color hex"></p>
            <div class="color block"></div>
            <button class="color generate" autofocus>Random color</button>
            <div class="color historybtn close"></div>
        </div>
    </main>
    <script>
        const rendom_color_btn = document.querySelector('.color.generate')
        const color_block = document.querySelector('.color.block')
        const color_history = document.querySelector('.color.historybtn')
        const color_hex = document.querySelector('.color.hex')
        const hex_range = ['1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f']
        var timestampStart, startX = 0
        var is_mobile
        var color_history_arr = []
        var hist_open = false

        const contains = (elem, arr) => {for (var i = 0; i < arr.length; i++) {if (arr[i] === elem) {return true;}} return false;}
        const getRandomInt = (max) => {return Math.floor(Math.random() * max);}
        const blackout = (power, hex) => {
            hex = hex.substring(1)
            result = ''
            for (let i in hex){
                hex_range.indexOf(hex[i])
                console.log(hex_range.indexOf(hex[i]));
            }
            return hex
        }
        const generate_hex = () => {
            var result = '#';
            for(var step = 0; step < 6; step++){result += hex_range[getRandomInt(15)]};
            return result;
        }
        var now_hex = generate_hex()
        const change_color = (hex) => {
            now_hex = hex
            color_history_arr.unshift(hex)
            color_hex.textContent = hex;
            rendom_color_btn.style = `outline: 2px solid ${hex}`
            color_history.style = `outline: 2px solid ${hex}`
            color_block.style = `background-color: ${hex}; box-shadow: 5px 5px 10px 1px ${hex}70;`;
            document.body.style = `background-color: ${hex}50;`
        }
        const open_color_history = () => {
            if(hist_open == false){
                hist_open = true;
                history_contaier = document.createElement('div');
                history_contaier.classList = 'color history';
                for(let i in color_history_arr){
                    history_item = document.createElement('div');
                    history_item.classList = 'color item';
                    history_item.innerHTML = `<div class="color demo" style="background-color: ${color_history_arr[i]}"></div><div class="color hex">${color_history_arr[i]}</div>`;
                    history_contaier.append(history_item);
                }
                document.querySelector('body').append(history_contaier);
            }
            else{
                hist_open = false;
                document.querySelector('.color.history').remove();
            }
        }


        rendom_color_btn.addEventListener('click', (event) => {if (hist_open == true){open_color_history()}; change_color(generate_hex())})
        rendom_color_btn.addEventListener('focus', (event) => {rendom_color_btn.style = `outline: 2px solid ${now_hex}`})
        rendom_color_btn.addEventListener('blur', (event) => {rendom_color_btn.style = `outline: 1px solid ${now_hex}`})
        document.body.addEventListener('keydown', (event) => {if (hist_open == false){if (contains(event.keyCode, [37, 38, 39, 40, 13])){change_color(generate_hex())}}})
        document.body.addEventListener('touchstart', (event) => {startX = event.touches[0].clientX; timestampStart = event.timeStamp;})
        document.body.addEventListener('click', (event) => {if (event.target.classList[1] == 'hex' || event.target.classList.value == 'color history' || event.target.classList.value == 'color demo'){}else if (event.target.classList[1] == 'historybtn'){open_color_history()}else if (hist_open == true){open_color_history()}})
        document.body.addEventListener('touchend', (event) => {if (hist_open == true){open_color_history()};if (Math.abs(startX - event.changedTouches[0].clientX) > 70 && event.timeStamp - timestampStart < 300){change_color(generate_hex())}})
        
        change_color(now_hex)
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {is_mobile = true;} 
        else {is_mobile = false;}
    </script>
</body>
</html>